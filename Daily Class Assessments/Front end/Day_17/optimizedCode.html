<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

    <h2>Opptimized Dashboard</h2>
    <h3>Cache Selectors, single DOM update, document Fragment, promise.all, async/await</h3>
    <p>we can see the difference on console via logs</p>
    <ul id="userList"></ul>

    <script>
        async function loadDashboard(){

            const timeStart = performance.now();

            // fatching the data concurently --- promise.all()
            const[users,posts] = await Promise.all([
                fetch("https://jsonplaceholder.typicode.com/users").then(r => r.json()),
                fetch("https://jsonplaceholder.typicode.com/posts").then(r => r.json())
            ])

            // Cache

            // Use a documentFragement(in-memory) to batch DOM update(single append child we will be keeping)
            const fragment = document.createDocumentFragment();

            // Here we have build or keep the elements in-memory : 
            // so we use cached selector only at the final append

            users.slice(0,20).forEach(u => {
                const li = document.createElement("li");
                li.textContent = `${u.name} - ${u.email}`;
                fragment.appendChild(li); // causing many DOM mutations
            })

            // Single Dom Mutation using cached selector
            userList.appendChild(fragment);

            const timeStop = performance.now();
            console.log("Total Time Taken : ",Math.round(timeStop - timeStart));
            console.log("Users : ",users.length , "Posts : ",posts.length);

        }
        loadDashboard();
    </script>

</body>
</html>